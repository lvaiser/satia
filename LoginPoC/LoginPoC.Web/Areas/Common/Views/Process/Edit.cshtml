@using LoginPoC.Model.User
@using LoginPoC.Model.Process
@using LoginPoC.Web.Areas.Common.Models
@using Newtonsoft.Json
@model ProcessViewModel

@{
    var jsonModel = JsonConvert.SerializeObject(Model);
    ViewBag.Title = "Trámite";
    var enableEdit = this.User.IsInRole(ApplicationUserRoles.User);
    var enableReview = this.User.IsInRole(ApplicationUserRoles.Agent)
                    || this.User.IsInRole(ApplicationUserRoles.Administrator);
}

<div ng-controller="Process.Edit" ng-init='events.onInit(@Html.Raw(jsonModel), @enableEdit.ToString().ToLower(), @enableReview.ToString().ToLower())'>
    <h2 class="tituloPrincipal"> {{ process.type.name }} </h2>
    <hr class="tituloPrincipal" />
    <div class="row">Campos</div>
    <div class="row">
        <div ng-repeat="field in process.fields track by $index" class="col-md-4 tramite">
            <label>
                {{ field.name }}
                <input ng-model="field.value" class="form-control" type="{{ inputType(field) }}" ng-if="simpleInputType(field.type)" ng-disabled="!editEnabled"/>
                <input ng-model="field.value" class="form-control" type="{{ inputType(field) }}" step="0.01" ng-if="stepInputType(field.type)" ng-disabled="!editEnabled">
                <input non-digit-input ng-model="field.value" class="form-control" type="{{ inputType(field) }}" ng-if="noNumbersInputType(field.type)" ng-disabled="!editEnabled">
                <textarea ng-model="field.value" class="form-control" ng-if="textAreaType(field.type)" ng-disabled="!editEnabled"></textarea>
                <select ng-model="field.selectedValue" ng-change="setSelectedValue(field)" ng-options="item as item.value for item in field.selectList track by item.key" class="form-control" ng-if="selectType(field.type)" ng-disabled="!editEnabled"></select>
            </label>
        </div>
    </div>
    <div class="row">Documentos</div>
    <div class="row"> 
        <div ng-repeat="document in process.documents track by $index" class="col-md-4 tramite">
            <label>
                {{ document.name }}
                <input ng-model="document.isAvailable" class="form-control" type="checkbox" ng-disabled="!editEnabled"/>
            </label>
        </div>
    </div>

    <div class="row" ng-show="reviewEnabled || !!process.reviewNotes">
    <hr />
        <div class="col-md-4">
            <label>
                Observaciones
            </label>
            <textarea class="form-control" ng-model="process.reviewNotes" ng-disabled="!reviewEnabled"></textarea>
        </div>
    </div>

    <div class="row">
    <hr />

        <div class="text-center" ng-if="reviewEnabled">
            <button class="btn btn-danger text" ng-click="events.onRejectClicked();">Rechazar</button>
            <button class="btn btn-success text" ng-click="events.onApproveClicked();">Aprobar</button>
        </div>

        <div class="text-center" ng-if="editEnabled">
            <button class="btn btn-default text" ng-click="events.onSaveClicked();">Guardar Cambios</button>
            <button class="btn btn-primary text" ng-click="events.onSendToReviewClicked();">Enviar a revision</button>
        </div>
    </div>
</div>


@section Scripts{
    <script src="~/Scripts/Site/Process/Process.Edit.js"></script>
<script src="~/Scripts/Site/Angular-Extras/Directives/non-digit-input.js"></script>
}
